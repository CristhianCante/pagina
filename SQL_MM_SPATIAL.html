<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Módulo: SQL/MM Spatial - Guía de PostGIS Bogotá</title>
    <!-- Tailwind CSS para un diseño rápido y responsivo -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Google Fonts: Inter -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
        }
        /* Estilos para el contenido del artículo */
        .article-content h2 {
            font-size: 1.875rem; /* text-3xl */
            font-weight: 800; /* extrabold */
            color: #1f2937; /* gray-800 */
            margin-top: 2.5rem; /* mt-10 */
            margin-bottom: 1rem; /* mb-4 */
            border-bottom: 2px solid #e5e7eb; /* border-gray-200 */
            padding-bottom: 0.5rem; /* pb-2 */
        }
        .article-content h3 {
            font-size: 1.5rem; /* text-2xl */
            font-weight: 700; /* bold */
            color: #1f2937; /* gray-800 */
            margin-top: 2rem; /* mt-8 */
            margin-bottom: 1rem; /* mb-4 */
        }
        .article-content p, .article-content ul, .article-content ol {
            font-size: 1.125rem; /* text-lg */
            color: #374151; /* gray-700 */
            line-height: 1.75;
            margin-bottom: 1rem;
        }
        .article-content ul {
            list-style-type: disc;
            padding-left: 2rem;
        }
        .article-content a {
            color: #2563eb; /* blue-600 */
            text-decoration: none;
            transition: color 0.2s;
        }
        .article-content a:hover {
            color: #1d4ed8; /* blue-800 */
            text-decoration: underline;
        }
        .article-content code:not(.hljs) { /* Código inline */
            background-color: #e5e7eb;
            padding: 0.125rem 0.375rem;
            border-radius: 0.25rem;
            font-family: monospace;
            font-size: 0.9em;
        }
        .code-block-container {
            position: relative;
            margin-top: 1.5rem;
            margin-bottom: 1.5rem;
        }
        .copy-button {
            position: absolute;
            top: 0.75rem;
            right: 0.75rem;
            background-color: #4b5563;
            color: white;
            padding: 0.25rem 0.75rem;
            border-radius: 0.375rem;
            font-size: 0.875rem;
            cursor: pointer;
            transition: background-color 0.2s;
            border: 1px solid #6b7280;
        }
        .copy-button:hover {
            background-color: #374151;
        }
        .copy-button.copied {
            background-color: #16a34a; /* green-600 */
        }
    </style>
    <!-- Highlight.js para el resaltado de sintaxis SQL -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/atom-one-dark.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/languages/sql.min.js"></script>
</head>
<body class="bg-gray-50 text-gray-800">

    <div class="container mx-auto px-4 sm:px-6 lg:px-8 py-10">

        <!-- ===== NAVEGACIÓN DE VUELTA ===== -->
        <nav class="mb-6">
            <a href="index.html" class="text-blue-600 hover:text-blue-800 hover:underline transition-colors duration-200 text-lg">
                &larr; Volver a la página principal de la guía
            </a>
        </nav>

        <!-- ===== CABECERA DEL MÓDULO ===== -->
        <header class="mb-12">
            <h1 class="text-4xl md:text-5xl font-extrabold text-gray-900 mb-2">
                SQL/MM Spatial: El Estándar para Datos Geográficos
            </h1>
            <p class="text-xl text-gray-600">
                Comprendiendo la norma que permite la manipulación y análisis de datos espaciales en bases de datos relacionales.
            </p>
        </header>

        <article class="bg-white p-6 sm:p-8 lg:p-12 rounded-xl shadow-md border border-gray-200 article-content">
            
            <h2>1. ¿Qué es SQL/MM Spatial?</h2>
            <p>
                <strong>SQL/MM Spatial</strong> es una parte del estándar internacional SQL (Structured Query Language) que se especializa en el manejo de datos geoespaciales. MM significa "MultiMedia". Esta extensión define un conjunto de tipos de datos, funciones y vistas de metadatos para permitir que las bases de datos relacionales, como PostgreSQL, puedan almacenar, gestionar y analizar información geográfica de manera estandarizada.
            </p>
            <p>
                Surgió como una evolución de la especificación OpenGIS Simple Features for SQL, con su primera versión apareciendo en 1999. PostGIS implementa gran parte de este estándar, lo que garantiza la interoperabilidad con otras herramientas SIG.
            </p>
            
            <h2>2. Jerarquía de Tipos de Geometría</h2>
            <p>El estándar SQL/MM define una jerarquía de tipos de datos para representar objetos espaciales. Los fundamentales son:</p>
            <ul>
                <li><strong>ST_Point:</strong> Geometrías de dimensión 0 que representan una única ubicación (un par de coordenadas X, Y).</li>
                <li><strong>ST_Curve:</strong> Geometrías unidimensionales que representan líneas o trayectorias. El tipo más común dentro de esta categoría es <code>ST_LineString</code>.</li>
                <li><strong>ST_Surface:</strong> Geometrías bidimensionales que tienen un área, definidas por una secuencia de puntos que forman un límite cerrado. El tipo más común es <code>ST_Polygon</code>.</li>
                <li><strong>ST_GeomCollection:</strong> Una colección que puede agrupar múltiples objetos espaciales (puntos, líneas y/o polígonos) en una sola entidad.</li>
            </ul>

            <h2>3. Categorías de Funciones Espaciales</h2>
            <p>El estándar organiza las funciones espaciales en varias categorías lógicas.</p>

            <h3>3.1. Creación y Conversión</h3>
            <p>Permiten crear geometrías a partir de diferentes formatos (texto, binario) y convertirlas entre sí.</p>
            <ul>
                <li><code>ST_GeomFromText(text)</code></li>
                <li><code>ST_AsText(geometry)</code></li>
                <li><code>ST_AsBinary(geometry)</code></li>
                <li><code>ST_Transform(geometry, SRID)</code></li>
            </ul>

            <h3>3.2. Propiedades Geométricas</h3>
            <p>Permiten obtener información básica y descriptiva sobre una geometría.</p>
            <ul>
                <li><code>ST_Dimension(geom)</code></li>
                <li><code>ST_SRID(geom)</code></li>
                <li><code>ST_GeometryType(geom)</code></li>
                <li><code>ST_IsEmpty(geom)</code></li>
                <li><code>ST_IsValid(geom)</code></li>
            </ul>

            <h3>3.3. Medición</h3>
            <p>Permiten calcular distancias, áreas o longitudes.</p>
            <ul>
                <li><code>ST_Length(geom)</code></li>
                <li><code>ST_Area(geom)</code></li>
                <li><code>ST_Distance(geom1, geom2)</code></li>
                <li><code>ST_Perimeter(geom)</code></li>
            </ul>

            <h3>3.4. Relaciones Topológicas</h3>
            <p>Permiten analizar cómo se relacionan espacialmente dos geometrías.</p>
            <ul>
                <li><code>ST_Equals(geom1, geom2)</code></li>
                <li><code>ST_Intersects(geom1, geom2)</code></li>
                <li><code>ST_Contains(geom1, geom2)</code></li>
                <li><code>ST_Within(geom1, geom2)</code></li>
                <li><code>ST_Crosses(geom1, geom2)</code></li>
            </ul>

            <h3>3.5. Manipulación Geométrica</h3>
            <p>Permiten modificar, combinar o expandir geometrías para generar nuevas.</p>
            <ul>
                <li><code>ST_Buffer(geom, dist)</code></li>
                <li><code>ST_Union(geom1, geom2)</code></li>
                <li><code>ST_Intersection(geom1, geom2)</code></li>
            </ul>

            <h2>4. Ejemplos Prácticos</h2>
            <p>A continuación, se muestran algunos ejemplos de cómo se aplican estas funciones estandarizadas.</p>

            <p><strong>Obtener el SRID de una capa:</strong></p>
            <div class="code-block-container">
                <button class="copy-button">Copiar</button>
                <pre><code class="language-sql">SELECT ST_SRID(geom) AS srid FROM "Engativa" LIMIT 1;</code></pre>
            </div>

            <p><strong>Identificar el tipo de geometría de una capa:</strong></p>
            <div class="code-block-container">
                <button class="copy-button">Copiar</button>
                <pre><code class="language-sql">SELECT ST_GeometryType(geom) AS tipo_geometria
FROM "Vias"
LIMIT 5;</code></pre>
            </div>

            <p><strong>Encontrar qué sectores catastrales están contenidos en la localidad de Engativá:</strong></p>
            <div class="code-block-container">
                <button class="copy-button">Copiar</button>
                <pre><code class="language-sql">SELECT e."LocNombre", s."SCANOMBRE"
FROM "Engativa" e, "sectores catastrales" s
WHERE ST_Contains(e.geom, s.geom)
LIMIT 5;</code></pre>
            </div>

            <p><strong>Encontrar la vía más larga dentro del sector "JARDIN BOTANICO":</strong></p>
            <div class="code-block-container">
                <button class="copy-button">Copiar</button>
                <pre><code class="language-sql">SELECT
    v."MVINOMBRE" AS via,
    s."SCANOMBRE" AS sector,
    ST_Length(v.geom) AS longitud_via
FROM "Vias" v
JOIN "sectores catastrales" s ON ST_Within(v.geom, s.geom)
WHERE v."MVINOMBRE" IS NOT NULL AND s."SCANOMBRE" = 'JARDIN BOTANICO'
ORDER BY longitud_via DESC
LIMIT 1;</code></pre>
            </div>

            <p><strong>Encontrar el punto de cruce entre dos avenidas:</strong></p>
             <div class="code-block-container">
                <button class="copy-button">Copiar</button>
                <pre><code class="language-sql">SELECT
    a."MVINOMBRE" AS via_1,
    b."MVINOMBRE" AS via_2,
    ST_AsText(ST_Intersection(a.geom, b.geom)) AS punto_cruce
FROM "Vias" a
JOIN "Vias" b ON ST_Crosses(a.geom, b.geom) AND a.id < b.id
WHERE a."MVINOMBRE" = 'AVENIDA MEDELLIN' AND b."MVINOMBRE" = 'AVENIDA DEL CONGRESO EUCARISTICO'
LIMIT 1;</code></pre>
            </div>

        </article>
        
        <!-- ===== PIE DE PÁGINA ===== -->
        <footer class="text-center mt-16 pt-8 border-t border-gray-300">
            <p class="text-gray-600">&copy; 2024 Universidad Distrital Francisco José de Caldas. Todos los derechos reservados.</p>
            <p class="text-sm text-gray-500 mt-1">Este material se distribuye bajo la licencia Creative Commons Atribución-CompartirIgual.</p>
        </footer>
    </div>
    <script>
        // Inicializa Highlight.js para resaltar todos los bloques de código
        hljs.highlightAll();

        // Agrega la funcionalidad de copiado a todos los botones
        const copyButtons = document.querySelectorAll('.copy-button');
        copyButtons.forEach(button => {
            button.addEventListener('click', () => {
                const pre = button.parentElement.querySelector('pre > code');
                const textToCopy = pre.innerText;

                // Usamos un textarea temporal para copiar el texto
                const textArea = document.createElement('textarea');
                textArea.value = textToCopy;
                document.body.appendChild(textArea);
                textArea.select();
                try {
                    document.execCommand('copy');
                    button.innerText = 'Copiado!';
                    button.classList.add('copied');
                } catch (err) {
                    console.error('Error al copiar el texto: ', err);
                    button.innerText = 'Error';
                }
                document.body.removeChild(textArea);

                // Revertir el texto del botón después de 2 segundos
                setTimeout(() => {
                    button.innerText = 'Copiar';
                    button.classList.remove('copied');
                }, 2000);
            });
        });
    </script>
</body>
</html>
