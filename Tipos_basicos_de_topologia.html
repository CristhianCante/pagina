<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Módulo: Tipos Básicos de Topología - Guía de PostGIS Bogotá</title>
    <!-- Tailwind CSS para un diseño rápido y responsivo -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Google Fonts: Inter -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
        }
        /* Estilos para el contenido del artículo */
        .article-content h2 {
            font-size: 1.875rem; /* text-3xl */
            font-weight: 800; /* extrabold */
            color: #1f2937; /* gray-800 */
            margin-top: 2.5rem; /* mt-10 */
            margin-bottom: 1rem; /* mb-4 */
            border-bottom: 2px solid #e5e7eb; /* border-gray-200 */
            padding-bottom: 0.5rem; /* pb-2 */
        }
        .article-content h3 {
            font-size: 1.5rem; /* text-2xl */
            font-weight: 700; /* bold */
            color: #1f2937; /* gray-800 */
            margin-top: 2rem; /* mt-8 */
            margin-bottom: 1rem; /* mb-4 */
        }
        .article-content p, .article-content ul, .article-content ol {
            font-size: 1.125rem; /* text-lg */
            color: #374151; /* gray-700 */
            line-height: 1.75;
            margin-bottom: 1rem;
        }
        .article-content ul {
            list-style-type: disc;
            padding-left: 2rem;
        }
        .article-content a {
            color: #2563eb; /* blue-600 */
            text-decoration: none;
            transition: color 0.2s;
        }
        .article-content a:hover {
            color: #1d4ed8; /* blue-800 */
            text-decoration: underline;
        }
        .article-content code:not(.hljs) { /* Código inline */
            background-color: #e5e7eb;
            padding: 0.125rem 0.375rem;
            border-radius: 0.25rem;
            font-family: monospace;
            font-size: 0.9em;
        }
        .code-block-container {
            position: relative;
            margin-top: 1.5rem;
            margin-bottom: 1.5rem;
        }
        .copy-button {
            position: absolute;
            top: 0.75rem;
            right: 0.75rem;
            background-color: #4b5563;
            color: white;
            padding: 0.25rem 0.75rem;
            border-radius: 0.375rem;
            font-size: 0.875rem;
            cursor: pointer;
            transition: background-color 0.2s;
            border: 1px solid #6b7280;
        }
        .copy-button:hover {
            background-color: #374151;
        }
        .copy-button.copied {
            background-color: #16a34a; /* green-600 */
        }
    </style>
    <!-- Highlight.js para el resaltado de sintaxis SQL -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/atom-one-dark.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/languages/sql.min.js"></script>
</head>
<body class="bg-gray-50 text-gray-800">

    <div class="container mx-auto px-4 sm:px-6 lg:px-8 py-10">

        <!-- ===== NAVEGACIÓN DE VUELTA ===== -->
        <nav class="mb-6">
            <a href="index.html" class="text-blue-600 hover:text-blue-800 hover:underline transition-colors duration-200 text-lg">
                &larr; Volver a la página principal de la guía
            </a>
        </nav>

        <!-- ===== CABECERA DEL MÓDULO ===== -->
        <header class="mb-12">
            <h1 class="text-4xl md:text-5xl font-extrabold text-gray-900 mb-2">
                Tipos Básicos de Topología
            </h1>
            <p class="text-xl text-gray-600">
                Entendiendo los Nodos, Aristas y Caras que componen un modelo topológico en PostGIS.
            </p>
        </header>

        <article class="bg-white p-6 sm:p-8 lg:p-12 rounded-xl shadow-md border border-gray-200 article-content">
            
            <h2>1. Los Elementos Fundamentales de la Topología</h2>
            <p>
                Un modelo topológico en PostGIS no almacena geometrías completas como polígonos o líneas de la forma tradicional. En su lugar, descompone el espacio en tres tipos de elementos básicos (o primitivas topológicas):
            </p>
            <ul>
                <li><strong>Nodo (Node):</strong> Un punto en 2D donde las aristas comienzan o terminan.</li>
                <li><strong>Arista (Edge):</strong> Una línea que conecta dos nodos. Las aristas definen los límites de las caras.</li>
                <li><strong>Cara (Face):</strong> Un área cerrada delimitada por un conjunto de aristas.</li>
            </ul>
            <p>Para que una topología sea válida, este conjunto de nodos, aristas y caras debe cumplir con una serie de reglas, como que las aristas no se crucen excepto en los nodos.</p>

            <h3>1.1. La Cara Universal</h3>
            <p>
                Un concepto clave en topología es la <strong>Cara Universal</strong>. Es la cara que representa "el resto del mundo", es decir, todo el espacio que no está cubierto por ninguna otra cara en la topología. Siempre tiene el ID 0. Cuando creas la primera arista en una topología vacía, estás dividiendo la Cara Universal. Cuando creas un polígono (una cara nueva), en realidad estás creando un "agujero" en la Cara Universal.
            </p>
            <img src="imagenes/Tipos basicos de topologia/imagen1.png" alt="[Diagrama de la localidad de Fontibón mostrando la Cara Universal alrededor]" class="w-full max-w-lg mx-auto my-4 rounded-lg shadow-md border">

            <h2>2. Interpretación de los Bordes (Aristas)</h2>
            <p>
                Las aristas son los elementos más complejos, ya que contienen la información de conectividad. Para entender cómo funcionan, debemos considerar su dirección y perspectiva.
            </p>
            
            <h3>2.1. Dirección, Izquierda y Derecha</h3>
            <p>
                Toda arista en una topología tiene una dirección, desde un <strong>nodo inicial</strong> a un <strong>nodo final</strong>. Esta dirección es fundamental para definir qué hay a su "izquierda" y a su "derecha".
            </p>
            <img src="imagenes/Tipos basicos de topologia/imagen2.png" alt="[Diagrama mostrando la perspectiva de una arista y la definición de su lado izquierdo y derecho]" class="w-full max-w-2xl mx-auto my-4 rounded-lg shadow-md border">
            <p>
                Imagina que caminas a lo largo de una arista, desde su nodo inicial hasta su nodo final. La cara que queda a tu mano izquierda es la "cara izquierda" (left_face) y la que queda a tu derecha es la "cara derecha" (right_face).
            </p>
             <img src="imagenes/Tipos basicos de topologia/imagen3.png" alt="[Diagrama de un polígono (Cara 1) rodeado por la Cara Universal, mostrando la izquierda y derecha de cada arista]" class="w-full max-w-xl mx-auto my-4 rounded-lg shadow-md border">

            <h3>2.2. La Tabla `edge_data`</h3>
            <p>
                PostGIS almacena toda esta información relacional en una tabla llamada <code>edge</code> (o <code>edge_data</code>) dentro del esquema de la topología. Sus columnas principales son:
            </p>
            <ul class="space-y-2">
                <li><code>edge_id</code>: ID único de la arista.</li>
                <li><code>start_node</code>: ID del nodo inicial.</li>
                <li><code>end_node</code>: ID del nodo final.</li>
                <li><code>left_face</code>: ID de la cara a la izquierda de la arista.</li>
                <li><code>right_face</code>: ID de la cara a la derecha de la arista.</li>
                <li><code>next_left_edge</code>: ID de la siguiente arista que continúa formando la cara izquierda.</li>
                <li><code>next_right_edge</code>: ID de la siguiente arista que continúa formando la cara derecha.</li>
                <li><code>geom</code>: La geometría `LINESTRING` de la arista.</li>
            </ul>

            <h2>3. Ejemplo Práctico: Creando una Topología de Barrios</h2>
            <p>Vamos a aplicar estos conceptos para crear un modelo topológico a partir de una capa de barrios de Fontibón.</p>

            <h3>Paso 1: Crear la Topología</h3>
            <p>Primero, creamos un esquema de topología vacío. Le damos un nombre y le asignamos un SRID.</p>
            <div class="code-block-container">
                <button class="copy-button">Copiar</button>
                <pre><code class="language-sql">-- Crea una nueva topología llamada 'topo_barrios' con el SRID de Bogotá
SELECT topology.CreateTopology('topo_barrios', 3116);</code></pre>
            </div>

            <h3>Paso 2: Añadir una Columna de TopoGeometría</h3>
            <p>Luego, añadimos una columna de tipo <code>topogeometry</code> a nuestra tabla de barrios para almacenar la representación topológica de cada polígono.</p>
            <div class="code-block-container">
                <button class="copy-button">Copiar</button>
                <pre><code class="language-sql">SELECT topology.AddTopoGeometryColumn(
    'topo_barrios',      -- Nombre de la topología
    'public',            -- Esquema de la tabla
    'Barrios_Fontibon',  -- Nombre de la tabla
    'topogeom',          -- Nombre de la nueva columna
    'POLYGON'            -- Tipo de geometría esperado
);</code></pre>
            </div>

            <h3>Paso 3: Poblar la Columna de TopoGeometría</h3>
            <p>Finalmente, convertimos las geometrías simples (`geom`) a su formato topológico (`topogeom`) usando la función <code>toTopoGeom</code>. Este es el paso que analiza los polígonos, los descompone en nodos, aristas y caras, y los almacena en el modelo topológico.</p>
            <div class="code-block-container">
                <button class="copy-button">Copiar</button>
                <pre><code class="language-sql">UPDATE "Barrios_Fontibon" 
SET topogeom = topology.toTopoGeom(geom, 'topo_barrios', 1);</code></pre>
            </div>

            <h3>Paso 4: Consultar los Datos Topológicos</h3>
            <p>Una vez creada la topología, podemos consultar directamente la tabla <code>edge</code> para ver las relaciones que se han creado.</p>
            <div class="code-block-container">
                <button class="copy-button">Copiar</button>
                <pre><code class="language-sql">SELECT
    edge_id,
    start_node,
    end_node,
    ST_Length(geom) AS longitud,
    left_face AS cara_izquierda,
    right_face AS cara_derecha,
    geom
FROM topo_barrios.edge
LIMIT 10;</code></pre>
            </div>
            <img src="imagenes/Tipos basicos de topologia/imagen4.png" alt="[Resultado de la consulta]" class="w-full max-w-lg mx-auto my-4 rounded-lg shadow-md border">
            <p>Esta consulta nos mostrará los detalles de las aristas, incluyendo qué caras tienen a cada lado, permitiéndonos realizar análisis de adyacencia y conectividad de una manera muy eficiente.</p>

        </article>
        
        <!-- ===== PIE DE PÁGINA ===== -->
        <footer class="text-center mt-16 pt-8 border-t border-gray-300">
            <p class="text-gray-600">&copy; 2024 Universidad Distrital Francisco José de Caldas. Todos los derechos reservados.</p>
            <p class="text-sm text-gray-500 mt-1">Este material se distribuye bajo la licencia Creative Commons Atribución-CompartirIgual.</p>
        </footer>
    </div>
    <script>
        // Inicializa Highlight.js para resaltar todos los bloques de código
        hljs.highlightAll();

        // Agrega la funcionalidad de copiado a todos los botones
        const copyButtons = document.querySelectorAll('.copy-button');
        copyButtons.forEach(button => {
            button.addEventListener('click', () => {
                const pre = button.parentElement.querySelector('pre > code');
                const textToCopy = pre.innerText;

                // Usamos un textarea temporal para copiar el texto
                const textArea = document.createElement('textarea');
                textArea.value = textToCopy;
                document.body.appendChild(textArea);
                textArea.select();
                try {
                    document.execCommand('copy');
                    button.innerText = 'Copiado!';
                    button.classList.add('copied');
                } catch (err) {
                    console.error('Error al copiar el texto: ', err);
                    button.innerText = 'Error';
                }
                document.body.removeChild(textArea);

                // Revertir el texto del botón después de 2 segundos
                setTimeout(() => {
                    button.innerText = 'Copiar';
                    button.classList.remove('copied');
                }, 2000);
            });
        });
    </script>
</body>
</html>
